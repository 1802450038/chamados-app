<title>Chamados</title>

<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../res/_css/index.css">
    <link rel="stylesheet" href="../../res/_css/menu-bar.css">
    <link rel="stylesheet" href="../../res/_css/simple-grid.min.css">
    <link rel="stylesheet" href="../../res/_css/form.css">
    <link rel="stylesheet" href="../../res/_css/entity-list.css">
    <link rel="stylesheet" href="../../res/_css/table.css">
    <link rel="stylesheet" href="../../res/_css/card.css">
    <link rel="stylesheet" href="../../res/_css/entity-profile.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

</head>

<body>
    <div class="header">

        <div class="logo">
            <a href="/admin">
                <img src="../../res/_assets/_contentimg/logo_mobile.png" alt="" srcset="" class="logo-img">

            </a>
        </div>

        <div class="logo-mobile">
            <a href="/admin">
                <img src="../../res/_assets/_contentimg/logo_branca.png" alt="" srcset="" class="logo-img">

            </a>
        </div>
        <div class="title">
            <h1 class="title-page">Chamados</h1>
            <h3 class="sub-title-page">App</h3>
        </div>
    </div>

    <div class="content-body">
        <div class="list-body" style="margin-top: -20px;">
            <div class="list-body-content">
                <div class="list-body-top">
                    <div class="list-category-title">
                        <h3 class="list-title">Chamados</h3>
                        <div class="clock">
                            <span id="hour">15:49</span>
                            <span id="date">23/12</span>
                        </div>
                    </div>
                    <div class="list-category-sub-title">
                        <p class="list-sub-title">lista de chamados </p>
                    </div>
                </div>
                <div class="list-body-middle">
                    <div class="list-table-body">
                        <table>
                            <thead>
                                <th>Setor</th>
                                <th>Departamento</th>
                                <th>Problema</th>
                                <th>Status</th>
                                <th>Data</th>
                                <th>Previsão</th>
                            </thead>
                            <tbody id="table-content">


                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>

    <script>
     

        function notifyMe() {
            if (!("Notification" in window)) {
                // Check if the browser supports notifications
                alert("This browser does not support desktop notification");
            } else if (Notification.permission === "granted") {
                // Check whether notification permissions have already been granted;
                // if so, create a notification
                const notification = new Notification("Guriiiis tem chamad");
                // …
            } else if (Notification.permission !== "denied") {
                // We need to ask the user for permission
                Notification.requestPermission().then((permission) => {
                    // If the user accepts, let's create a notification
                    if (permission === "granted") {
                        const notification = new Notification("Guriiiis tem chamado");
                        // …
                    }
                });
            }

            // At last, if the user has denied notifications, and you
            // want to be respectful there is no need to bother them anymore.
        }


        let numOfCalls = 0
        let lastNumOfCalls = 0;


        function countItems(response) {

            let numOfCalls = response.split("<tr>").length - 1;
            if (numOfCalls > lastNumOfCalls) {
                notifyMe()
                lastNumOfCalls = numOfCalls
            } else if (numOfCalls < lastNumOfCalls) {
                lastNumOfCalls = numOfCalls;
            }

        }


        function loadXMLDoc() {
            var xhttp = new XMLHttpRequest()
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    table = document.getElementById("table-content")
                    table.innerHTML = this.responseText;

                    countItems(this.responseText)


                    let time = this.responseText.split("<")[14].split(" ")[12];
                    timeH = document.getElementById("hour");
                    timeD = document.getElementById("date");
                    const date = new Date();
                    let day = date.getDate();
                    let month = date.getMonth() + 1;
                    let year = date.getFullYear();
                    let hour = date.getHours();
                    let min = date.getMinutes() < 10 ? '0' : '' + date.getMinutes();
                    let currentDate = `${day}/${month}/${year}`;
                    let currentHour = `${hour}:${min}`;
                    timeH.innerHTML = currentHour;
                    timeD.innerHTML = currentDate;
                }
            };
            xhttp.open("GET", "../../admin-live-calls-view.php", true);
            xhttp.send();

        }
        setInterval(function () {
            loadXMLDoc();
            // 1sec
        }, 5000);

        window.onload = loadXMLDoc;


    </script>

</html>